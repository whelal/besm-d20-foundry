<form class="{{cssClass}} flexcol">
  <!-- ===== Header ===== -->
  <header class="sheet-header flexrow">
    <img class="profile" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="96" width="96"/>
    <div class="header-fields flexcol">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'BESMD20.CharacterName'}}"/>
      </h1>

      <div class="header-meta grid header-grid">
        <div class="meta-field">
          <label>{{localize "BESMD20.CharacterPoints"}}</label>
          <span class="meta-value">{{characterPoints.total}}</span>
        </div>
        <div class="meta-field">
          <label>{{localize "BESMD20.Health"}}</label>
          <div class="meta-split">
            <input type="number" name="system.health.value" value="{{numberValue system.health.value}}" data-dtype="Number"/>
            <span>/</span>
            <input type="number" name="system.health.max" value="{{numberValue system.health.max}}" data-dtype="Number"/>
          </div>
        </div>
        <div class="meta-field">
          <label>{{localize "BESMD20.Energy"}}</label>
          <div class="meta-split">
            <input type="number" name="system.energy.value" value="{{numberValue system.energy.value}}" data-dtype="Number"/>
            <span>/</span>
            <input type="number" name="system.energy.max" value="{{numberValue system.energy.max}}" data-dtype="Number"/>
          </div>
        </div>
        <div class="meta-field">
          <label>{{localize "BESMD20.Defense"}}</label>
          <input type="number" name="system.defense.value" value="{{numberValue system.defense.value}}" data-dtype="Number"/>
        </div>
        <div class="meta-field">
          <label>{{localize "BESMD20.BaseMovement"}}</label>
          <div class="meta-split">
            <input type="number" name="system.movement.base" value="{{numberValue system.movement.base}}" data-dtype="Number"/>
            <span>+</span>
            <input type="number" name="system.movement.misc" value="{{numberValue system.movement.misc}}" data-dtype="Number"/>
            <span>=</span>
            <span class="meta-value">{{system.movement.total}}</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== Tabs ===== -->
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="main">{{localize "BESMD20.TabMain"}}</a>
    <a class="item" data-tab="skills">{{localize "BESMD20.TabSkills"}}</a>
    <a class="item" data-tab="powers">{{localize "BESMD20.TabPowers"}}</a>
    <a class="item" data-tab="attributes">{{localize "BESMD20.TabAttributes"}}</a>
    <a class="item" data-tab="defects">{{localize "BESMD20.TabDefects"}}</a>
    <a class="item" data-tab="equipment">{{localize "BESMD20.Equipment"}}</a>
    <a class="item" data-tab="bio">{{localize "BESMD20.TabBiography"}}</a>
  </nav>

  <!-- ===== Body ===== -->
  <section class="sheet-body content">

    <!-- === Main Tab === -->
    <div class="tab" data-group="primary" data-tab="main">
      <section class="sheet-section section-info">
        <h2 class="section-title">{{localize "BESMD20.SectionCharacterInformation"}}</h2>

        <div class="info-grid grid grid-2col">
          <div class="panel">
            <h3 class="panel-title">{{localize "BESMD20.Details"}}</h3>
            <ol class="details-list">
              <li class="detail flexrow">
                <label>{{localize "BESMD20.PlayerName"}}</label>
                <input type="text" name="system.details.playerName" value="{{system.details.playerName}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.GMName"}}</label>
                <input type="text" name="system.details.gmName" value="{{system.details.gmName}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Campaign"}}</label>
                <input type="text" name="system.details.campaign" value="{{system.details.campaign}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.StartingLevel"}}</label>
                <input type="number" name="system.details.startingLevel" value="{{numberValue system.details.startingLevel}}" data-dtype="Number"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.DiscretionaryPoints"}}</label>
                <input type="number" name="system.details.discretionaryPoints" value="{{numberValue system.details.discretionaryPoints}}" data-dtype="Number"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Race"}}</label>
                <input type="text" name="system.details.race" value="{{system.details.race}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Size"}}</label>
                <input type="text" name="system.details.size" value="{{system.details.size}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Age"}}</label>
                <input type="text" name="system.details.age" value="{{system.details.age}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Gender"}}</label>
                <input type="text" name="system.details.gender" value="{{system.details.gender}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Height"}}</label>
                <input type="text" name="system.details.height" value="{{system.details.height}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Weight"}}</label>
                <input type="text" name="system.details.weight" value="{{system.details.weight}}"/>
              </li>
              <li class="detail flexrow">
                <label>{{localize "BESMD20.Appearance"}}</label>
                <input type="text" name="system.details.appearance" value="{{system.details.appearance}}"/>
              </li>
            </ol>
          </div>

          <div class="panel">
            <h3 class="panel-title">{{localize "BESMD20.SectionAbilityScores"}}</h3>
            <table class="ability-table">
              <thead>
                <tr>
                  <th>{{localize "BESMD20.Name"}}</th>
                  <th>{{localize "BESMD20.Score"}}</th>
                  <th>{{localize "BESMD20.Modifier"}}</th>
                  <th>{{localize "BESMD20.Roll"}}</th>
                </tr>
              </thead>
              <tbody>
                {{#each config.abilities as |abilityLabel abilityKey|}}
                  {{#with (lookup ../system.abilities abilityKey) as |ability|}}
                  <tr>
                    <td class="ability-name">{{abilityLabel}}</td>
                    <td><input type="number" name="system.abilities.{{abilityKey}}.value" value="{{numberValue ability.value}}" data-dtype="Number"/></td>
                    <td class="ability-mod">{{signedNumber ability.mod}}</td>
                    <td class="ability-roll">
                      <a class="rollable" data-roll="1d20+{{ability.mod}}" data-label="{{abilityLabel}} Check">
                        <i class="fas fa-dice-d20"></i>
                      </a>
                    </td>
                  </tr>
                  {{/with}}
                {{/each}}
              </tbody>
            </table>

            <h3 class="panel-title">{{localize "BESMD20.SectionCalculatedValues"}}</h3>
            <table class="saves-table">
              <thead>
                <tr>
                  <th>{{localize "BESMD20.SavingThrows"}}</th>
                  <th>{{localize "BESMD20.Base"}}</th>
                  <th>{{localize "BESMD20.AbilityMod"}}</th>
                  <th>{{localize "BESMD20.Misc"}}</th>
                  <th>{{localize "BESMD20.Total"}}</th>
                </tr>
              </thead>
              <tbody>
                {{#with system.saves.fortitude as |fort|}}
                <tr>
                  <td>{{localize "BESMD20.SavingThrowFortitude"}}</td>
                  <td><input type="number" name="system.saves.fortitude.base" value="{{numberValue fort.base}}" data-dtype="Number"/></td>
                  <td>{{signedNumber fort.abilityMod}}</td>
                  <td><input type="number" name="system.saves.fortitude.misc" value="{{numberValue fort.misc}}" data-dtype="Number"/></td>
                  <td>{{signedNumber fort.total}}</td>
                </tr>
                {{/with}}
                {{#with system.saves.reflex as |ref|}}
                <tr>
                  <td>{{localize "BESMD20.SavingThrowReflex"}}</td>
                  <td><input type="number" name="system.saves.reflex.base" value="{{numberValue ref.base}}" data-dtype="Number"/></td>
                  <td>{{signedNumber ref.abilityMod}}</td>
                  <td><input type="number" name="system.saves.reflex.misc" value="{{numberValue ref.misc}}" data-dtype="Number"/></td>
                  <td>{{signedNumber ref.total}}</td>
                </tr>
                {{/with}}
                {{#with system.saves.will as |will|}}
                <tr>
                  <td>{{localize "BESMD20.SavingThrowWill"}}</td>
                  <td><input type="number" name="system.saves.will.base" value="{{numberValue will.base}}" data-dtype="Number"/></td>
                  <td>{{signedNumber will.abilityMod}}</td>
                  <td><input type="number" name="system.saves.will.misc" value="{{numberValue will.misc}}" data-dtype="Number"/></td>
                  <td>{{signedNumber will.total}}</td>
                </tr>
                {{/with}}
              </tbody>
            </table>

            <table class="combat-table">
              <tbody>
                <tr>
                  <th>{{localize "BESMD20.BaseAttackBonus"}}</th>
                  <td><input type="number" name="system.combat.baseAttackBonus" value="{{numberValue system.combat.baseAttackBonus}}" data-dtype="Number"/></td>
                  <th>{{localize "BESMD20.MeleeAttack"}}</th>
                  <td>{{signedNumber system.combat.meleeTotal}}</td>
                </tr>
                <tr>
                  <th>{{localize "BESMD20.RangedAttack"}}</th>
                  <td>{{signedNumber system.combat.rangedTotal}}</td>
                  <th>{{localize "BESMD20.Initiative"}}</th>
                  <td>
                    <div class="meta-split">
                      <input type="number" name="system.combat.initiativeMisc" value="{{numberValue system.combat.initiativeMisc}}" data-dtype="Number"/>
                      <span>=</span>
                      <span class="meta-value">{{signedNumber system.combat.initiativeTotal}}</span>
                    </div>
                  </td>
                </tr>
                <tr>
                  <th>{{localize "BESMD20.ArmorClass"}}</th>
                  <td>
                    <div class="meta-split">
                      <input type="number" name="system.armor.value" value="{{numberValue system.armor.value}}" data-dtype="Number"/>
                      <span>+</span>
                      <input type="number" name="system.combat.defenseMisc" value="{{numberValue system.combat.defenseMisc}}" data-dtype="Number"/>
                      <span>=</span>
                      <span class="meta-value">{{system.combat.armorClass}}</span>
                    </div>
                  </td>
                  <th>{{localize "BESMD20.ShockValue"}}</th>
                  <td><input type="number" name="system.combat.shockValue" value="{{numberValue system.combat.shockValue}}" data-dtype="Number"/></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>

    <!-- === Skills Tab === -->
    <div class="tab" data-group="primary" data-tab="skills">
      <h3 class="items-header">{{localize "BESMD20.Skills"}}</h3>
      <table class="skills-table">
        <thead>
          <tr>
            <th>{{localize "BESMD20.Name"}}</th>
            <th>{{localize "BESMD20.Ability"}}</th>
            <th>{{localize "BESMD20.Rank"}}</th>
            <th>{{localize "BESMD20.AbilityMod"}}</th>
            <th>{{localize "BESMD20.SkillTotal"}}</th>
            <th>{{localize "BESMD20.Roll"}}</th>
          </tr>
        </thead>
        <tbody>
          {{#each config.skills as |label key|}}
            {{#with (lookup ../system.skills key) as |skill|}}
            <tr class="skill-row" data-skill-key="{{../key}}">
              <td>{{label}}</td>
              <td>
                <select name="system.skills.{{../key}}.ability">
                  {{#each ../../config.abilities as |al abKey|}}
                    <option value="{{abKey}}" {{#if (eq abKey skill.ability)}}selected{{/if}}>{{al}}</option>
                  {{/each}}
                </select>
              </td>
              <td><input type="number" name="system.skills.{{../key}}.rank" value="{{numberValue skill.rank}}" data-dtype="Number"/></td>
              <td>{{signedNumber skill.abilityMod}}</td>
              <td>{{signedNumber skill.total}}</td>
              <td class="skill-roll"><a class="rollable" data-roll="1d20+{{skill.total}}" data-label="{{label}} Check"><i class="fas fa-dice-d20"></i></a></td>
            </tr>
            {{/with}}
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- === Powers Tab === -->
    <div class="tab" data-group="primary" data-tab="powers">
      <div class="items-header flexrow">
        <h3>{{localize "BESMD20.Powers"}}</h3>
        <a class="item-control item-create" title="{{localize 'BESMD20.ItemCreate'}}" data-type="power"><i class="fas fa-plus"></i> {{localize "BESMD20.Add"}}</a>
      </div>
      <ol class="items-list">
        <li class="item-header flexrow">
          <div class="item-name">{{localize "BESMD20.Name"}}</div>
          <div class="item-rank">{{localize "BESMD20.Rank"}}</div>
          <div class="item-cost">{{localize "BESMD20.TotalCost"}}</div>
          <div class="item-controls"></div>
        </li>
        {{#each powers as |item|}}
        <li class="item flexrow" data-item-id="{{#if item.id}}{{item.id}}{{else}}{{item._id}}{{/if}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-rank">{{item.system.rank}}</div>
          <div class="item-cost">{{item.system.totalCost}}</div>
          <div class="item-controls">
            <a class="item-control item-activate" title="{{localize 'BESMD20.Activate'}}"><i class="fas fa-magic"></i></a>
            <a class="item-control item-edit" title="{{localize 'BESMD20.ItemEdit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'BESMD20.ItemDelete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
        {{#unless powers.length}}
        <li class="item empty">{{localize "BESMD20.PowersEmpty"}}</li>
        {{/unless}}
      </ol>
    </div>

    <!-- === Attributes Tab === -->
    <div class="tab" data-group="primary" data-tab="attributes">
      <div class="items-header flexrow">
        <h3>{{localize "BESMD20.Attributes"}}</h3>
        <a class="item-control item-create" title="{{localize 'BESMD20.ItemCreate'}}" data-type="attribute"><i class="fas fa-plus"></i> {{localize 'BESMD20.Add'}}</a>
      </div>
      <ol class="items-list">
        <li class="item-header flexrow">
          <div class="item-name">{{localize "BESMD20.Name"}}</div>
          <div class="item-rank">{{localize "BESMD20.Rank"}}</div>
          <div class="item-cost">{{localize "BESMD20.TotalCost"}}</div>
          <div class="item-controls"></div>
        </li>
        {{#each attributes as |item|}}
        <li class="item flexrow" data-item-id="{{#if item.id}}{{item.id}}{{else}}{{item._id}}{{/if}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-rank">{{item.system.rank}}</div>
          <div class="item-cost">{{item.system.totalCost}}</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="{{localize 'BESMD20.ItemEdit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'BESMD20.ItemDelete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
        {{#unless attributes.length}}
        <li class="item empty">{{localize "BESMD20.AttributesFeatsEmpty"}}</li>
        {{/unless}}
      </ol>
    </div>

    <!-- === Defects Tab === -->
    <div class="tab" data-group="primary" data-tab="defects">
      <div class="items-header flexrow">
        <h3>{{localize "BESMD20.Defects"}}</h3>
        <a class="item-control item-create" title="{{localize 'BESMD20.ItemCreate'}}" data-type="defect"><i class="fas fa-plus"></i> {{localize 'BESMD20.Add'}}</a>
      </div>
      <ol class="items-list">
        <li class="item-header flexrow">
          <div class="item-name">{{localize "BESMD20.Name"}}</div>
          <div class="item-cost">{{localize "BESMD20.TotalBonus"}}</div>
          <div class="item-controls"></div>
        </li>
        {{#each defects as |item|}}
        <li class="item flexrow" data-item-id="{{#if item.id}}{{item.id}}{{else}}{{item._id}}{{/if}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-cost">{{item.system.totalBonus}}</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="{{localize 'BESMD20.ItemEdit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'BESMD20.ItemDelete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
        {{#unless defects.length}}
        <li class="item empty">{{localize "BESMD20.DefectsEmpty"}}</li>
        {{/unless}}
      </ol>
    </div>

    <!-- === Equipment Tab === -->
    <div class="tab" data-group="primary" data-tab="equipment">
      <div class="items-header flexrow">
        <h3>{{localize "BESMD20.Equipment"}}</h3>
        <a class="item-control item-create" title="{{localize 'BESMD20.ItemCreate'}}" data-type="equipment"><i class="fas fa-plus"></i> {{localize 'BESMD20.Add'}}</a>
      </div>
      <ol class="items-list">
        <li class="item-header flexrow">
          <div class="item-name">{{localize "BESMD20.Name"}}</div>
          <div class="item-rank">{{localize "BESMD20.Quantity"}}</div>
          <div class="item-cost">{{localize "BESMD20.Weight"}}</div>
          <div class="item-cost">{{localize "BESMD20.Cost"}}</div>
          <div class="item-controls"></div>
        </li>
        {{#each equipment as |item|}}
        <li class="item flexrow" data-item-id="{{#if item.id}}{{item.id}}{{else}}{{item._id}}{{/if}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-rank">{{item.system.quantity}}</div>
          <div class="item-cost">{{item.system.weight}}</div>
          <div class="item-cost">{{item.system.cost}}</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="{{localize 'BESMD20.ItemEdit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'BESMD20.ItemDelete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    <!-- === Biography Tab === -->
    <div class="tab" data-group="primary" data-tab="bio">
      <h3>{{localize "BESMD20.Biography"}}</h3>
      {{editor system.biography target="system.biography" button=true editable=editable}}
    </div>
  </section>
</form>
